# 前端富文本编辑器关于 OP 与 CRDT 的总结

# 绪论

国内的富文本资料很少，而且研究这方面的人也很少。或许是我研究和探索不够，一叶障目，对外界主流缺乏认知。在研究 Appflowy、分布式系统后，暂将富文本的协同核心点列出来对比。

# OP 与 CRDT

富文本的 OP（Operation Transformation）算法和 CRDT（Conflict-free Replicated Data Type）都是用于实现多用户实时协作编辑的技术，但它们有一些不同之处。

1. Operation Transformation (OP) 算法:

   - OP 算法是一种用于实现协作编辑的技术，它可以处理多个用户并发编辑同一个文档的情况。
   - OP 算法将用户的编辑操作转换成操作序列，并在共享的文档上应用这些操作序列，以实现数据同步和一致性。
   - 当多个用户同时编辑文档时，可能会出现冲突，OP 算法会对这些冲突进行解决，并确保最终所有用户的文档状态是一致的。
   - OP 算法在处理冲突时，可能需要额外的服务器支持，例如中心化的服务器或 OT 服务器，以协调不同用户的编辑操作。

2. Conflict-free Replicated Data Type (CRDT):
   - CRDT 是一种用于实现分布式系统中数据同步的技术，它的设计目标是实现数据的最终一致性，解决多个副本之间的冲突问题。
   - CRDT 不需要中心化的服务器或 OT 算法来处理冲突，而是通过设计特定的数据结构和操作规则，确保在多个副本上应用相同的操作后，最终达成一致的数据状态。
   - CRDT 中的操作是可交换和可并发的，因此可以在不同副本之间进行同步，而不需要复杂的冲突解决算法。

区别：

- OP 算法主要用于处理协作编辑的情况，它需要额外的服务器支持来处理冲突和解决并发编辑问题。而 CRDT 是一种更通用的数据同步技术，可以应用于更广泛的分布式系统场景，不依赖于中心化的服务器和复杂的冲突解决算法。
- CRDT 采用了一种更简单的设计思路，通过约束数据结构和操作规则来确保最终一致性，而 OP 算法可能需要更复杂的实现和协调机制。

使用范畴和优劣：

- OP 算法适用于需要实现实时协作编辑的场景，如在线文档编辑、实时绘图工具等。它可以处理多用户并发编辑，但可能需要中心化服务器和复杂的冲突解决算法。
- CRDT 适用于更广泛的分布式系统场景，包括多副本数据库、实时协作应用、分布式存储等。它的设计更简单，不需要中心化服务器，并且可以在分布式系统中实现高度可用和最终一致性。
- 优劣：OP 算法在某些复杂情况下可能需要更复杂的实现和服务器支持，而 CRDT 的设计相对简单，更容易实现和部署。然而，CRDT 的一些特定场景下可能会有性能和存储上的开销。

目前在实际应用中，CRDT 技术得到了广泛的应用，特别是在分布式系统中实现数据同步和一致性。一些流行的 CRDT 数据类型包括 LWW-Element-Set、OR-Set、G-Counter、PN-Counter 等。而 OP 算法也在一些特定的协作编辑应用中得到了应用，但相对于 CRDT，在更广泛的分布式系统中使用较少。

## 推荐框架-YJS

Yjs（Your data, Shared）是一个基于 CRDT 的开源分布式数据协作框架。它被设计用于在多个用户之间共享和协作编辑实时数据，例如文本文档、绘图、表格等。Yjs 使用 CRDT 技术来解决并发冲突，确保数据在多个用户之间同步和一致。

Yjs 提供了一种易于使用的数据同步模型，它允许开发者将其集成到各种应用中，实现多用户实时协作功能。Yjs 支持多种数据类型的同步，如文本、数组、Map、Set 等，并提供了一组操作和事件，开发者可以根据应用的需求来处理数据的变更和同步。
